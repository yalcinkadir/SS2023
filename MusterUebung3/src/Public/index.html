<!doctype html>
<html lang="de">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <title>Meine Webseite</title>
  </head>
  <body>
    <div class="container">
        <nav class="navbar navbar-expand-lg navbar-light bg-light">
            <a class="navbar-brand" href="#">Produktbetrachter</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
                    aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav" id="productTypes">
                    <!-- Die Produkttypen werden hier geladen -->
                </ul>
            </div>
        </nav>
        <div class="mt-3" id="products">
            <!-- Die Produkte werden hier geladen -->
        </div>
    </div>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.0.min.js" integrity="sha256-2Pmvv0kuTBOenSvLm6bvfBSSHrUJ+3A7x6P5Ebd07/g=" crossorigin="anonymous"></script>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>    
    <!-- Eigene Skript -->
    <script>
        $(document).ready(function () {
            $.getJSON("/SS2023/MusterUebung3/index.php?action=listTypes", function (data) {
                console.log(data);
                $.each(data, function (index, item) {
                    console.log('Type of productType:', item);
                    var liElement = $("<li>").addClass("nav-item");
                    var link = $("<a>")
                        .addClass("nav-link")
                        .text(item.name)
                        .click(function (event) {
                            event.preventDefault();
                            // Remove the active class from all links
                            $('.active').removeClass('active');
                            // Add the active class to the clicked link
                            $(this).addClass('active');
                            loadProducts(item.url);
                        });
                    liElement.append(link);
                    $("#productTypes").append(liElement);
                });
            });
        });

        function loadProducts(url) {
    fetch(url)
        .then(response => response.json())
        .then(data => {
            $("#products").text("");
            if (data.errors) {
                $("#products").text(data.errors);
            } else {
                if (data.error) {
                    $("#products").text(data.error);
                    return;
                }

                var mainList = $("<ul class=\"row\" >")

                data.products.forEach(item => {
                    var liElement = $("<li class=\"col-6 col-sm-3\" style='position: relative; padding: 10px; display:inline'>");

                    var productCard = $("<div>").addClass("card grid-item").css("width", "18rem");

                    var productImage = $("<img>")
                    .attr("src", "/src/Public/products/" + item.id + ".png")
                        .attr("alt", item.name)
                        .addClass("card-img-top");

                    var cardBody = $("<div>").addClass("card-body");

                    var productName = $("<span>").addClass("card-title").text(item.name);

                    cardBody.append(productName);
                    productCard.append(productImage).append(cardBody);
                    liElement.append(productCard);
                    mainList.append(liElement);
                });

                $("#products").append(mainList);
            }
        })
        .catch(error => {
            $("#products").text(error);
            console.error(error)
        });
}

    </script>
  </body>
</html>
