<!DOCTYPE html>
<html lang="de">

<head>
    <title>Produktbetrachter</title>
    <link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" rel="stylesheet">
    <script crossorigin="anonymous"
            integrity="sha256-2Pmvv0kuTBOenSvLm6bvfBSSHrUJ+3A7x6P5Ebd07/g=" src="https://code.jquery.com/jquery-3.7.0.min.js"></script>

</head>

<body>
<div class="container">
    <div class="mt-3" id="productTypes">
        <!-- Die Produkttypen werden hier geladen -->
    </div>
    <div class="mt-3" id="products">
        <!-- Die Produkte werden hier geladen -->
    </div>
</div>

<script>
    $(document).ready(function () {
        $.getJSON("/Uebung4/index.php?action=listTypes", function (data) {
            console.log(data);
            $.each(data, function (index, item) {
                console.log('Type of productType:', item);
                var button = $("<button>")
                    .addClass("btn btn-primary")
                    .text(item.name)
                    .click(function () {
                        // Remove the highlight from all buttons
                        $('.highlight').css('background-color', '');
                        $('.highlight').removeClass('highlight');

                        // Highlight the clicked button
                        $(this).css('background-color', '#259BF8');
                        $(this).addClass('highlight');
                        loadProducts(item.url, button);
                    });
                $("#productTypes").append(button);
            });
        });
    });

    function loadProducts(url) {
        fetch(url)
            .then(response => response.json())
            .then(data => {
                $("#products").text("");
                if (data.errors) {
                    $("#products").text(data.errors);
                } else {

                    if (data.error) {
                        $("#products").text(data.error);
                        return;
                    }

                    var mainList = $("<ul class=\"row\" >")

                    data.products.forEach(item => {
                        var liElement = $("<li class=\"col-6 col-sm-3\" style='position: relative;\n" +
                            "padding: 10px;\n" +
                            "display:inline'>");

                        var productCard = $("<div>").addClass("card grid-item").css("width", "18rem");

                        var productImage = $("<img>")
                            .attr("src", "/Uebung4/products/" + item.id + ".png")
                            .attr("alt", item.name)
                            .addClass("card-img-top");

                        var cardBody = $("<div>").addClass("card-body");

                        var productName = $("<span>").addClass("card-title").text(item.name);

                        cardBody.append(productName);
                        liElement.append(productCard).append(productImage).append(cardBody);
                        mainList.append(liElement);
                    });

                    $("#products").append(mainList);
                }
            })
            .catch(error => {
                $("#products").text(error);
                console.error(error)
            });
    }
</script>

</body>

</html>